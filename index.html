<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Friendly Chat</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 0;
        }
        
        .container {
            width: 100%;
            height: 100vh;
            background: white;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        /* Mobile First Design */
        .setup-panel {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            display: none; /* Hidden by default on mobile */
        }
        
        .setup-panel.active {
            display: block;
        }
        
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .chat-header {
            padding: 15px 20px;
            background: #667eea;
            color: white;
            display: flex;
            align-items: center;
            gap: 12px;
            position: relative;
        }
        
        .mobile-menu-btn {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid white;
        }
        
        .header-info {
            flex: 1;
        }
        
        .header-info h3 {
            font-size: 16px;
            margin-bottom: 2px;
        }
        
        .header-info p {
            font-size: 12px;
            opacity: 0.9;
        }
        
        /* Chat Messages - Mobile Optimized */
        .chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background: #f8f9fa;
            display: flex;
            flex-direction: column;
            min-height: 0; /* Important for mobile */
        }
        
        .message {
            margin: 8px 0;
            padding: 12px 15px;
            border-radius: 18px;
            max-width: 85%;
            animation: fadeIn 0.3s ease;
            word-wrap: break-word;
            position: relative;
        }
        
        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(10px); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0); 
            }
        }
        
        .message.sent {
            background: #667eea;
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }
        
        .message.received {
            background: white;
            border: 1px solid #e9ecef;
            border-bottom-left-radius: 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .message-time {
            font-size: 10px;
            opacity: 0.8;
            margin-top: 4px;
            text-align: right;
        }
        
        .chat-input {
            padding: 15px;
            background: white;
            border-top: 1px solid #e9ecef;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .chat-input input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 14px;
            outline: none;
            min-height: 44px; /* Better touch target */
        }
        
        .chat-input button {
            padding: 12px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            min-height: 44px; /* Better touch target */
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .chat-input button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        /* Connection Status */
        .connection-status {
            padding: 12px 15px;
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            margin-bottom: 15px;
            border-radius: 8px;
            font-size: 14px;
        }
        
        /* Action Buttons */
        .action-btn {
            width: 100%;
            padding: 15px;
            margin: 8px 0;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        /* Auto Connect Section */
        .auto-connect-section {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #28a745;
        }
        
        .code-display {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            border: 2px dashed #667eea;
        }
        
        .room-code {
            font-size: 22px;
            font-weight: bold;
            color: #667eea;
            letter-spacing: 2px;
            margin: 10px 0;
            font-family: monospace;
        }
        
        /* User List */
        .user-list {
            margin-top: 15px;
        }
        
        .user-item {
            padding: 12px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        
        .online { background: #28a745; }
        .offline { background: #dc3545; }
        .connecting { background: #ffc107; }
        
        /* Desktop Styles */
        @media (min-width: 768px) {
            .container {
                flex-direction: row;
                height: 90vh;
                max-width: 1000px;
                border-radius: 15px;
                box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            }
            
            .setup-panel {
                width: 300px;
                display: flex;
                flex-direction: column;
                border-right: 1px solid #e9ecef;
                border-bottom: none;
                padding: 25px;
            }
            
            .mobile-menu-btn {
                display: none;
            }
            
            .message {
                max-width: 70%;
                padding: 15px 20px;
            }
            
            .chat-header {
                padding: 20px;
            }
            
            .user-avatar {
                width: 45px;
                height: 45px;
            }
        }
        
        /* Large Mobile */
        @media (max-width: 767px) and (min-width: 480px) {
            .message {
                max-width: 80%;
            }
            
            .chat-messages {
                padding: 20px;
            }
        }
        
        /* Small Mobile */
        @media (max-width: 479px) {
            .message {
                max-width: 90%;
                padding: 10px 12px;
            }
            
            .chat-messages {
                padding: 12px;
            }
            
            .chat-input {
                padding: 12px;
            }
            
            .chat-input button span {
                display: none;
            }
            
            .chat-input button {
                padding: 12px;
                width: 44px;
                justify-content: center;
            }
        }
        
        /* Very Small Screens */
        @media (max-width: 360px) {
            .message {
                max-width: 95%;
                font-size: 14px;
            }
            
            .chat-header {
                padding: 12px 15px;
            }
            
            .header-info h3 {
                font-size: 15px;
            }
        }
        
        /* Ensure messages are visible */
        .chat-messages::-webkit-scrollbar {
            width: 4px;
        }
        
        .chat-messages::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        .chat-messages::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Setup Panel (Hidden on mobile by default) -->
        <div class="setup-panel" id="setupPanel">
            <h2 style="margin-bottom: 15px; color: #333; text-align: center; font-size: 18px;">
                <i class="fas fa-comments"></i> Smart Chat
            </h2>
            
            <div class="connection-status" id="connectionStatus">
                <i class="fas fa-info-circle"></i> 
                <span id="statusText">Ready to connect</span>
            </div>
            
            <!-- Auto Connect Section -->
            <div class="auto-connect-section" id="autoConnectSection" style="display: none;">
                <h4 style="color: #28a745; margin-bottom: 8px; font-size: 14px;">
                    <i class="fas fa-bolt"></i> Auto Connect
                </h4>
                <p style="font-size: 12px; color: #666; margin-bottom: 12px;">
                    Connect instantly with saved partner
                </p>
                <button class="action-btn btn-success" onclick="autoReconnect()">
                    <i class="fas fa-plug"></i> Auto Reconnect
                </button>
            </div>
            
            <!-- Manual Connection -->
            <div id="manualConnection">
                <button class="action-btn btn-primary" onclick="createRoom()">
                    <i class="fas fa-plus"></i> Create New Room
                </button>
                
                <div class="code-display" id="roomCodeDisplay" style="display: none;">
                    <p style="font-weight: 600; font-size: 14px;">Share this code:</p>
                    <div class="room-code" id="roomCode">ABCD123</div>
                </div>
                
                <div style="text-align: center; margin: 15px 0; color: #666; font-size: 14px;">OR</div>
                
                <input type="text" id="joinCodeInput" placeholder="Enter partner code..." 
                       style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 12px; font-size: 14px;">
                
                <button class="action-btn btn-success" onclick="joinRoom()">
                    <i class="fas fa-sign-in-alt"></i> Join Room
                </button>
            </div>
            
            <!-- User List -->
            <div class="user-list">
                <h4 style="margin: 20px 0 12px; color: #333; font-size: 14px;">
                    <i class="fas fa-users"></i> Status
                </h4>
                <div id="userList">
                    <div class="user-item">
                        <span class="status-indicator offline"></span>
                        <span style="font-size: 14px;">Not connected</span>
                    </div>
                </div>
            </div>
            
            <button class="action-btn" onclick="resetAllConnections()" style="background: #6c757d; color: white; margin-top: auto;">
                <i class="fas fa-redo"></i> Reset All
            </button>
        </div>
        
        <!-- Chat Area -->
        <div class="chat-area">
            <div class="chat-header">
                <button class="mobile-menu-btn" id="mobileMenuBtn">
                    <i class="fas fa-bars"></i>
                </button>
                <img src="https://i.pravatar.cc/150?img=5" class="user-avatar" id="headerAvatar">
                <div class="header-info">
                    <h3 id="chatWithUser">Smart Chat</h3>
                    <p id="connectionInfo">Create or join a room</p>
                </div>
            </div>
            
            <!-- Chat Messages - This is the main area that should display properly -->
            <div class="chat-messages" id="chatMessages">
                <div class="message received">
                    <div>Welcome! Messages will appear here. On mobile, make sure this area is visible and scrollable.</div>
                    <div class="message-time">System</div>
                </div>
                <div class="message sent">
                    <div>This is a sent message example</div>
                    <div class="message-time">You • 10:30 AM</div>
                </div>
                <div class="message received">
                    <div>This is a received message example</div>
                    <div class="message-time">Partner • 10:31 AM</div>
                </div>
            </div>
            
            <div class="chat-input">
                <input type="text" id="messageInput" placeholder="Type a message..." disabled>
                <button id="sendButton" disabled>
                    <i class="fas fa-paper-plane"></i> <span>Send</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Mobile responsive chat functionality
        let currentRoom = null;
        let currentPartner = null;
        let isInitiator = false;
        
        // DOM Elements
        const setupPanel = document.getElementById('setupPanel');
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const chatWithUser = document.getElementById('chatWithUser');
        const connectionInfo = document.getElementById('connectionInfo');
        
        // Mobile menu toggle
        mobileMenuBtn.addEventListener('click', function() {
            setupPanel.classList.toggle('active');
        });
        
        // Close setup panel when clicking on chat area (mobile)
        chatMessages.addEventListener('click', function() {
            if (window.innerWidth <= 767) {
                setupPanel.classList.remove('active');
            }
        });
        
        // Generate random room code
        function generateRoomCode() {
            return Math.random().toString(36).substring(2, 8).toUpperCase();
        }
        
        // Create new room
        function createRoom() {
            currentRoom = generateRoomCode();
            isInitiator = true;
            currentPartner = "Alex Johnson";
            
            document.getElementById('roomCode').textContent = currentRoom;
            document.getElementById('roomCodeDisplay').style.display = 'block';
            updateStatus(`Room created: ${currentRoom}`, 'success');
            
            enableChat();
            simulateConnection();
            
            // Hide setup panel on mobile after connection
            if (window.innerWidth <= 767) {
                setupPanel.classList.remove('active');
            }
        }
        
        // Join existing room
        function joinRoom() {
            const code = document.getElementById('joinCodeInput').value.trim().toUpperCase();
            if (!code) {
                updateStatus('Please enter a room code', 'error');
                return;
            }
            
            currentRoom = code;
            isInitiator = false;
            currentPartner = "Sam Wilson";
            
            updateStatus(`Joined room: ${currentRoom}`, 'success');
            enableChat();
            simulateConnection();
            
            // Hide setup panel on mobile after connection
            if (window.innerWidth <= 767) {
                setupPanel.classList.remove('active');
            }
        }
        
        // Auto reconnect
        function autoReconnect() {
            // Simulate auto reconnect
            currentRoom = "AUTO123";
            currentPartner = "Saved Partner";
            updateStatus('Auto-connected!', 'success');
            enableChat();
            simulateConnection();
            
            if (window.innerWidth <= 767) {
                setupPanel.classList.remove('active');
            }
        }
        
        // Enable chat interface
        function enableChat() {
            messageInput.disabled = false;
            sendButton.disabled = false;
            chatWithUser.textContent = `Chat with ${currentPartner}`;
            connectionInfo.textContent = `Room: ${currentRoom}`;
            
            // Update user list
            document.getElementById('userList').innerHTML = `
                <div class="user-item">
                    <span class="status-indicator online"></span>
                    <span style="font-size: 14px;">You - Connected</span>
                </div>
                <div class="user-item">
                    <span class="status-indicator online"></span>
                    <span style="font-size: 14px;">${currentPartner}</span>
                </div>
            `;
        }
        
        // Simulate connection
        function simulateConnection() {
            setTimeout(() => {
                // Add connection message
                addMessage({
                    text: `Connected with ${currentPartner}! Start chatting...`,
                    sender: 'System',
                    time: new Date(),
                    type: 'received'
                });
            }, 1000);
        }
        
        // Send message
        function sendMessage() {
            const text = messageInput.value.trim();
            if (!text) return;
            
            const message = {
                text: text,
                sender: 'You',
                time: new Date(),
                type: 'sent'
            };
            
            addMessage(message);
            messageInput.value = '';
            
            // Clear input and refocus
            messageInput.focus();
            
            // Simulate reply
            setTimeout(() => {
                simulateReply();
            }, 1000 + Math.random() * 2000);
        }
        
        // Simulate receiving a message
        function simulateReply() {
            if (!currentPartner) return;
            
            const replies = [
                "Hello! Nice to chat with you!",
                "How are you doing today?",
                "This mobile chat works great!",
                "What would you like to talk about?",
                "I can see all messages properly now",
                "The mobile interface is smooth",
                "Glad we're connected!",
                "Ready to continue our conversation?"
            ];
            
            const randomReply = replies[Math.floor(Math.random() * replies.length)];
            
            const message = {
                text: randomReply,
                sender: currentPartner,
                time: new Date(),
                type: 'received'
            };
            
            addMessage(message);
        }
        
        // Add message to chat (IMPROVED FOR MOBILE)
        function addMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${message.type}`;
            
            const timeString = message.time.toLocaleTimeString([], { 
                hour: '2-digit', minute: '2-digit' 
            });
            
            messageDiv.innerHTML = `
                <div>${message.text}</div>
                <div class="message-time">${message.sender} • ${timeString}</div>
            `;
            
            chatMessages.appendChild(messageDiv);
            
            // Scroll to bottom smoothly
            setTimeout(() => {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 100);
        }
        
        // Update status
        function updateStatus(status, type = 'info') {
            const statusText = document.getElementById('statusText');
            statusText.textContent = status;
            
            const statusColors = {
                'info': '#fff3cd',
                'success': '#d1ecf1', 
                'error': '#f8d7da',
                'warning': '#fff3cd'
            };
            
            const borderColors = {
                'info': '#ffc107',
                'success': '#0c5460',
                'error': '#721c24',
                'warning': '#856404'
            };
            
            document.getElementById('connectionStatus').style.background = statusColors[type];
            document.getElementById('connectionStatus').style.borderLeftColor = borderColors[type];
        }
        
        // Reset all connections
        function resetAllConnections() {
            currentRoom = null;
            currentPartner = null;
            
            document.getElementById('roomCodeDisplay').style.display = 'none';
            document.getElementById('joinCodeInput').value = '';
            messageInput.disabled = true;
            sendButton.disabled = true;
            
            updateStatus('Reset complete', 'info');
            chatWithUser.textContent = 'Smart Chat';
            connectionInfo.textContent = 'Create or join a room';
            
            // Clear messages except first three examples
            const messages = chatMessages.querySelectorAll('.message');
            for (let i = 3; i < messages.length; i++) {
                messages[i].remove();
            }
        }
        
        // Event Listeners
        sendButton.addEventListener('click', sendMessage);
        
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        // Auto-focus message input when enabled
        messageInput.addEventListener('focus', function() {
            // Ensure virtual keyboard doesn't hide messages on mobile
            setTimeout(() => {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 300);
        });
        
        // Initialize
        updateStatus('Ready to connect', 'info');
        
        // Show auto connect section for demo
        setTimeout(() => {
            document.getElementById('autoConnectSection').style.display = 'block';
        }, 1000);
    </script>
</body>
</html>
