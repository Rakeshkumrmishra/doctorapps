<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Working Chat App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 10px;
        }
        
        .container {
            width: 100%;
            max-width: 400px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .chat-header {
            padding: 20px;
            background: #667eea;
            color: white;
            text-align: center;
        }
        
        .chat-messages {
            height: 400px;
            padding: 20px;
            overflow-y: auto;
            background: #f8f9fa;
            display: flex;
            flex-direction: column;
        }
        
        .message {
            margin: 10px 0;
            padding: 12px 16px;
            border-radius: 18px;
            max-width: 80%;
            animation: fadeIn 0.3s ease;
            word-wrap: break-word;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message.sent {
            background: #667eea;
            color: white;
            margin-left: auto;
            border-bottom-right-radius: 5px;
        }
        
        .message.received {
            background: white;
            border: 1px solid #e9ecef;
            border-bottom-left-radius: 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .message-time {
            font-size: 11px;
            opacity: 0.8;
            margin-top: 5px;
            text-align: right;
        }
        
        .chat-input-container {
            padding: 20px;
            background: white;
            border-top: 1px solid #e9ecef;
            display: flex;
            gap: 10px;
        }
        
        .chat-input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #ddd;
            border-radius: 25px;
            font-size: 14px;
            outline: none;
        }
        
        .send-btn {
            padding: 12px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .send-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .connection-panel {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        
        .btn {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .status {
            padding: 10px;
            background: #fff3cd;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="connection-panel">
            <div class="status" id="status">Ready to chat</div>
            <button class="btn btn-primary" onclick="startChatAsPerson1()">
                <i class="fas fa-user"></i> Start as Person 1
            </button>
            <button class="btn btn-success" onclick="startChatAsPerson2()">
                <i class="fas fa-user"></i> Start as Person 2
            </button>
        </div>
        
        <div class="chat-header">
            <h3 id="chatTitle">Simple Chat App</h3>
            <p id="chatSubtitle">Choose your role to start</p>
        </div>
        
        <div class="chat-messages" id="chatMessages">
            <div class="message received">
                <div>Welcome! Click buttons above to start chatting.</div>
                <div class="message-time">System</div>
            </div>
        </div>
        
        <div class="chat-input-container">
            <input type="text" class="chat-input" id="messageInput" placeholder="Type your message..." disabled>
            <button class="send-btn" id="sendButton" disabled>
                <i class="fas fa-paper-plane"></i> Send
            </button>
        </div>
    </div>

    <script>
        // Simple Chat Functionality - No Console Errors
        let chatActive = false;
        let currentUser = '';
        
        // DOM Elements
        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const status = document.getElementById('status');
        const chatTitle = document.getElementById('chatTitle');
        const chatSubtitle = document.getElementById('chatSubtitle');
        
        // Start as Person 1
        function startChatAsPerson1() {
            currentUser = 'Person 1';
            chatActive = true;
            
            enableChat();
            updateStatus('You are Person 1 - Start chatting!', 'success');
            chatTitle.textContent = 'Chat - Person 1';
            chatSubtitle.textContent = 'Connected and ready';
            
            addSystemMessage('You are now Person 1. Start the conversation!');
        }
        
        // Start as Person 2
        function startChatAsPerson2() {
            currentUser = 'Person 2';
            chatActive = true;
            
            enableChat();
            updateStatus('You are Person 2 - Start chatting!', 'success');
            chatTitle.textContent = 'Chat - Person 2';
            chatSubtitle.textContent = 'Connected and ready';
            
            addSystemMessage('You are now Person 2. Start the conversation!');
        }
        
        // Enable chat functionality
        function enableChat() {
            messageInput.disabled = false;
            sendButton.disabled = false;
            
            // Focus on input
            setTimeout(() => {
                messageInput.focus();
            }, 100);
        }
        
        // Update status
        function updateStatus(message, type = 'info') {
            status.textContent = message;
            status.style.background = type === 'success' ? '#d4edda' : '#fff3cd';
            status.style.color = type === 'success' ? '#155724' : '#856404';
        }
        
        // Add system message
        function addSystemMessage(text) {
            const message = {
                text: text,
                sender: 'System',
                time: new Date(),
                type: 'received'
            };
            addMessage(message);
        }
        
        // Send message - MAIN FUNCTION
        function sendMessage() {
            if (!chatActive) {
                alert('Please select your role first!');
                return;
            }
            
            const text = messageInput.value.trim();
            
            if (!text) {
                alert('Please type a message first!');
                messageInput.focus();
                return;
            }
            
            console.log('Sending message:', text); // Debug log
            
            // Create and add sent message
            const sentMessage = {
                text: text,
                sender: 'You',
                time: new Date(),
                type: 'sent'
            };
            addMessage(sentMessage);
            
            // Clear input
            messageInput.value = '';
            
            // Refocus input
            messageInput.focus();
            
            // Simulate reply after 1-2 seconds
            setTimeout(() => {
                simulateReply(text);
            }, 1000 + Math.random() * 1000);
        }
        
        // Simulate reply from other person
        function simulateReply(yourMessage) {
            if (!chatActive) return;
            
            const otherPerson = currentUser === 'Person 1' ? 'Person 2' : 'Person 1';
            
            // Smart replies based on your message
            let reply;
            const lowerMessage = yourMessage.toLowerCase();
            
            if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('hey')) {
                reply = "Hello! Nice to meet you! How are you doing?";
            } else if (lowerMessage.includes('how are you')) {
                reply = "I'm doing great! Thanks for asking. How about you?";
            } else if (lowerMessage.includes('?')) {
                reply = "That's a good question! Let me think about it...";
            } else if (lowerMessage.includes('thank')) {
                reply = "You're welcome! ðŸ˜Š";
            } else if (lowerMessage.includes('name')) {
                reply = `I'm ${otherPerson}. Nice to meet you!`;
            } else if (lowerMessage.includes('weather')) {
                reply = "The weather is nice today! Perfect for chatting.";
            } else if (lowerMessage.includes('love') || lowerMessage.includes('like')) {
                reply = "That's wonderful to hear!";
            } else {
                // Random friendly replies
                const replies = [
                    "That's interesting! Tell me more.",
                    "I understand what you mean.",
                    "That sounds great!",
                    "What do you think about this?",
                    "I agree with you!",
                    "That's a good point!",
                    "Thanks for sharing that!",
                    "What are your plans for today?",
                    "That's really helpful!",
                    "I'm happy we're chatting!",
                    "That's amazing!",
                    "How's your day going?",
                    "That's cool!",
                    "I'd love to hear more!",
                    "That's fantastic news!"
                ];
                reply = replies[Math.floor(Math.random() * replies.length)];
            }
            
            console.log('Simulating reply:', reply); // Debug log
            
            const receivedMessage = {
                text: reply,
                sender: otherPerson,
                time: new Date(),
                type: 'received'
            };
            addMessage(receivedMessage);
        }
        
        // Add message to chat
        function addMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${message.type}`;
            
            const timeString = message.time.toLocaleTimeString([], { 
                hour: '2-digit', minute: '2-digit' 
            });
            
            messageDiv.innerHTML = `
                <div>${message.text}</div>
                <div class="message-time">${message.sender} â€¢ ${timeString}</div>
            `;
            
            chatMessages.appendChild(messageDiv);
            
            // Scroll to bottom
            setTimeout(() => {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }, 50);
        }
        
        // Event Listeners - Simple and Clean
        sendButton.addEventListener('click', sendMessage);
        
        messageInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        // Initialize
        console.log('Chat app loaded successfully');
        
        // Add welcome message
        setTimeout(() => {
            addSystemMessage('This is a working chat demo. Click the buttons above to start!');
        }, 1000);
    </script>
</body>
</html>
